// Grover search on 4 qubits and 4 helper qubits

circuit: 8 qubits

// Init
H(0)
H(1)
H(2)
H(3)

// Grover iteration 1
// Z_0
// NNCCNOT(0,1,4)
H(4)
CNOT(1,4)
T(4)
CNOT(0,4)
T(4)
CNOT(1,4)
T(4)
CNOT(0,4)
CNOT(0,1)
D(1)
CNOT(0,1)
D(0)
D(1)
T(4)
H(4)

// NNCCNOT(2,3,5)
H(5)
CNOT(3,5)
T(5)
CNOT(2,5)
T(5)
CNOT(3,5)
T(5)
CNOT(2,5)
CNOT(2,3)
D(3)
CNOT(2,3)
D(2)
D(3)
T(5)
H(5)

// NNCCNOT(4,5,6)
H(6)
CNOT(5,6)
T(6)
CNOT(4,6)
T(6)
CNOT(5,6)
T(6)
CNOT(4,6)
CNOT(4,5)
D(5)
CNOT(4,5)
D(4)
D(5)
T(6)
H(6)

// The key step! 
CZ(6,7)

H(0)
H(1)
H(2)
H(3)

// Z_0
// NNCCNOT(0,1,4)
H(4)
CNOT(1,4)
T(4)
CNOT(0,4)
T(4)
CNOT(1,4)
T(4)
CNOT(0,4)
CNOT(0,1)
D(1)
CNOT(0,1)
D(0)
D(1)
T(4)
H(4)

// NNCCNOT(2,3,5)
H(5)
CNOT(3,5)
T(5)
CNOT(2,5)
T(5)
CNOT(3,5)
T(5)
CNOT(2,5)
CNOT(2,3)
D(3)
CNOT(2,3)
D(2)
D(3)
T(5)
H(5)

// NNCCNOT(4,5,6)
H(6)
CNOT(5,6)
T(6)
CNOT(4,6)
T(6)
CNOT(5,6)
T(6)
CNOT(4,6)
CNOT(4,5)
D(5)
CNOT(4,5)
D(4)
D(5)
T(6)
H(6)

// The key step! 
CZ(6,7)

H(0)
H(1)
H(2)
H(3)

Z(0)

// Grover iteration 2
// Z_0
// NNCCNOT(0,1,4)
H(4)
CNOT(1,4)
T(4)
CNOT(0,4)
T(4)
CNOT(1,4)
T(4)
CNOT(0,4)
CNOT(0,1)
D(1)
CNOT(0,1)
D(0)
D(1)
T(4)
H(4)

// NNCCNOT(2,3,5)
H(5)
CNOT(3,5)
T(5)
CNOT(2,5)
T(5)
CNOT(3,5)
T(5)
CNOT(2,5)
CNOT(2,3)
D(3)
CNOT(2,3)
D(2)
D(3)
T(5)
H(5)

// NNCCNOT(4,5,6)
H(6)
CNOT(5,6)
T(6)
CNOT(4,6)
T(6)
CNOT(5,6)
T(6)
CNOT(4,6)
CNOT(4,5)
D(5)
CNOT(4,5)
D(4)
D(5)
T(6)
H(6)

// The key step! 
CZ(6,7)

H(0)
H(1)
H(2)
H(3)

// Z_0
// NNCCNOT(0,1,4)
H(4)
CNOT(1,4)
T(4)
CNOT(0,4)
T(4)
CNOT(1,4)
T(4)
CNOT(0,4)
CNOT(0,1)
D(1)
CNOT(0,1)
D(0)
D(1)
T(4)
H(4)

// NNCCNOT(2,3,5)
H(5)
CNOT(3,5)
T(5)
CNOT(2,5)
T(5)
CNOT(3,5)
T(5)
CNOT(2,5)
CNOT(2,3)
D(3)
CNOT(2,3)
D(2)
D(3)
T(5)
H(5)

// NNCCNOT(4,5,6)
H(6)
CNOT(5,6)
T(6)
CNOT(4,6)
T(6)
CNOT(5,6)
T(6)
CNOT(4,6)
CNOT(4,5)
D(5)
CNOT(4,5)
D(4)
D(5)
T(6)
H(6)

// The key step! 
CZ(6,7)

H(0)
H(1)
H(2)
H(3)

Z(0)

// Grover iteration 3
// Z_0
// NNCCNOT(0,1,4)
H(4)
CNOT(1,4)
T(4)
CNOT(0,4)
T(4)
CNOT(1,4)
T(4)
CNOT(0,4)
CNOT(0,1)
D(1)
CNOT(0,1)
D(0)
D(1)
T(4)
H(4)

// NNCCNOT(2,3,5)
H(5)
CNOT(3,5)
T(5)
CNOT(2,5)
T(5)
CNOT(3,5)
T(5)
CNOT(2,5)
CNOT(2,3)
D(3)
CNOT(2,3)
D(2)
D(3)
T(5)
H(5)

// NNCCNOT(4,5,6)
H(6)
CNOT(5,6)
T(6)
CNOT(4,6)
T(6)
CNOT(5,6)
T(6)
CNOT(4,6)
CNOT(4,5)
D(5)
CNOT(4,5)
D(4)
D(5)
T(6)
H(6)

// The key step! 
CZ(6,7)

H(0)
H(1)
H(2)
H(3)

// Z_0
// NNCCNOT(0,1,4)
H(4)
CNOT(1,4)
T(4)
CNOT(0,4)
T(4)
CNOT(1,4)
T(4)
CNOT(0,4)
CNOT(0,1)
D(1)
CNOT(0,1)
D(0)
D(1)
T(4)
H(4)

// NNCCNOT(2,3,5)
H(5)
CNOT(3,5)
T(5)
CNOT(2,5)
T(5)
CNOT(3,5)
T(5)
CNOT(2,5)
CNOT(2,3)
D(3)
CNOT(2,3)
D(2)
D(3)
T(5)
H(5)

// NNCCNOT(4,5,6)
H(6)
CNOT(5,6)
T(6)
CNOT(4,6)
T(6)
CNOT(5,6)
T(6)
CNOT(4,6)
CNOT(4,5)
D(5)
CNOT(4,5)
D(4)
D(5)
T(6)
H(6)

// The key step! 
CZ(6,7)

H(0)
H(1)
H(2)
H(3)

Z(0)

assert state in span { |0000> , |++++> }

measure 0..3
